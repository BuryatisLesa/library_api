# Library API

RESTful API для управления библиотекой, реализованный с использованием FastAPI, SQLAlchemy и Alembic.

## Инструкция по запуску

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/BuryatisLesa/library_api.git
   cd library_api
   ```

2. Создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Windows: venv\Scripts\activate
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Примените миграции базы данных:
   ```bash
   alembic upgrade head
   ```

5. Запустите сервер:
   ```bash
   uvicorn app.main:app --reload
   ```

6. Документация доступна по адресу: [http://localhost:8000/docs](http://localhost:8000/docs)

## Регистрация первого пользователя

Для регистрации нового пользователя отправьте POST-запрос на эндпоинт `/auth/register` с телом запроса:

```json
{
  "email": "user@example.com",
  "password": "yourpassword"
}
```

После регистрации вы получите JWT-токен, который необходимо использовать для авторизации в защищённых эндпоинтах.

##  Структура проекта

```
library_api/
├── app/
│   ├── core/          # Настройки и конфигурации
│   ├── db/            # Модели и зависимости базы данных
│   ├── models/        # SQLAlchemy модели
│   ├── routers/       # Маршруты API
│   ├── schemas/       # Pydantic схемы
|   ├── tests/         # Автотесты
│   └── main.py        # Точка входа приложения
├── alembic/           # Миграции базы данных
├── requirements.txt   # Зависимости проекта
└── README.md          # Описание проекта
```

## Структура базы данных

- **User**: Хранит информацию о пользователях (id, email, hashed_password).
- **Book**: Содержит данные о книгах (id, title, author, copies_available, available).
- **Borrow**: Отслеживает информацию о заимствованиях (id, book_id, reader_id, borrowed_at, returned_at).

Связи между таблицами реализованы с использованием внешних ключей.

## Аутентификация

- Используется JWT (JSON Web Tokens) для аутентификации пользователей.
- Токены генерируются при успешной регистрации или входе пользователя.
- Защищённые эндпоинты требуют передачи токена в заголовке `Authorization: Bearer <token>`.
- Библиотеки: `fastapi`, `jose`, `passlib`.

## Бизнес-логика

- **4.1 Ограничение на количество заимствований**: Пользователь не может заимствовать более 3 книг одновременно.
- **4.2 Проверка доступности книги**: Перед заимствованием проверяется наличие доступных экземпляров книги.
- **4.3 Обработка возврата книги**: При возврате книги обновляется поле `returned_at` и увеличивается количество доступных экземпляров.
